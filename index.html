<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context-Aware Chatbot</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f0f0f0; margin: 0; padding: 0; }
        .chat-container { max-width: 600px; margin: 20px auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .chat-box { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: scroll; margin-bottom: 10px; border-radius: 4px; }
        .chat-input { width: calc(100% - 22px); padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .user-message { text-align: right; color: #2979FF; margin: 10px 0; }
        .bot-message { text-align: left; color: #00C853; margin: 10px 0; }
        .message { max-width: 80%; padding: 8px 12px; border-radius: 18px; display: inline-block; word-wrap: break-word; }
        .user-message .message { background-color: #E3F2FD; }
        .bot-message .message { background-color: #E8F5E9; }
        .typing-indicator { color: #888; font-style: italic; }
        .error-message { color: #D32F2F; font-style: italic; }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-box" id="chat-box"></div>
        <input type="text" class="chat-input" id="chat-input" placeholder="Type a message..." onkeydown="if(event.key === 'Enter') sendMessage()">
    </div>
    <script>
        const API_URL = 'https://644f-34-145-112-145.ngrok-free.app/predict'; // Update this URL with your current ngrok URL

        async function sendMessage() {
            const inputBox = document.getElementById('chat-input');
            const chatBox = document.getElementById('chat-box');
            const userMessage = inputBox.value.trim();
            if (userMessage === '') return;
            
            appendMessage('user-message', userMessage);
            inputBox.value = '';
            
            const typingIndicator = appendMessage('bot-message', 'Typing...');
            typingIndicator.classList.add('typing-indicator');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt: userMessage }),
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('API Response:', data); // For debugging
                
                chatBox.removeChild(typingIndicator);
                
                if (data.response) {
                    appendMessage('bot-message', data.response);
                } else if (data.error) {
                    appendMessage('bot-message error-message', `Error: ${data.error}`);
                } else {
                    appendMessage('bot-message error-message', 'Received an unexpected response from the server.');
                }
            } catch (error) {
                console.error('Error:', error);
                chatBox.removeChild(typingIndicator);
                appendMessage('bot-message error-message', `Error: ${error.message}`);
            }
        }
        
        function appendMessage(className, text) {
            const chatBox = document.getElementById('chat-box');
            const messageElem = document.createElement('div');
            messageElem.className = className;
            const messageContent = document.createElement('span');
            messageContent.className = 'message';
            messageContent.textContent = text;
            messageElem.appendChild(messageContent);
            chatBox.appendChild(messageElem);
            chatBox.scrollTop = chatBox.scrollHeight;
            return messageElem;
        }
    </script>
</body>
</html>
